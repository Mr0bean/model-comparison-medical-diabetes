<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº¤å‰è¯„ä¼°ç»“æœæŸ¥çœ‹å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .container {
            width: 100%;
            min-height: 100vh;
            margin: 0;
            background: white;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
            position: relative;
        }


        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header .subtitle {
            font-size: 16px;
            opacity: 0.9;
        }

        .patient-selector {
            padding: 25px 40px;
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
            border-bottom: 2px solid #e0e0e0;
        }

        .selector-label {
            font-size: 14px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 15px;
            display: block;
        }

        .patient-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .patient-btn {
            padding: 12px 24px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        .patient-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateY(-2px);
        }

        .patient-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 30px 40px;
            background: white;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e0e0e0;
        }

        .stat-label {
            font-size: 13px;
            color: #999;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }

        .section-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        .matrix-container {
            overflow-x: auto;
            background: white;
            border-radius: 8px;
            margin: 20px 0;
        }

        .matrix-table {
            border-collapse: collapse;
            width: 100%;
            min-width: 1000px;
        }

        .matrix-table th,
        .matrix-table td {
            padding: 12px 8px;
            text-align: center;
            border: 1px solid #e0e0e0;
            font-size: 13px;
        }

        .matrix-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .matrix-table .model-name {
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
            font-weight: 600;
            text-align: left;
            color: #667eea;
            position: sticky;
            left: 0;
            z-index: 5;
            padding-left: 15px;
        }

        .matrix-table .summary-header {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            font-size: 12px;
        }

        .matrix-table .summary-cell {
            background: #f8f9fa;
            font-weight: 600;
            color: #667eea;
            font-size: 12px;
        }

        .score-cell {
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            position: relative;
        }

        .score-cell:hover {
            transform: scale(1.15);
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.4);
            z-index: 3;
        }

        .score-high {
            background: #d4edda;
            color: #155724;
        }

        .score-medium {
            background: #fff3cd;
            color: #856404;
        }

        .score-low {
            background: #f8d7da;
            color: #721c24;
        }

        .score-highest {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%) !important;
            color: white !important;
            font-weight: 800;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        .score-lowest {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%) !important;
            color: white !important;
            font-weight: 800;
            box-shadow: 0 0 10px rgba(244, 67, 54, 0.5);
        }

        .self-eval {
            background: #e9ecef;
            color: #999;
            font-style: italic;
        }

        .ranking-list {
            background: white;
            border-radius: 8px;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s;
        }

        .ranking-item:hover {
            background: #f8f9ff;
        }

        .ranking-item:last-child {
            border-bottom: none;
        }

        .rank-number {
            font-size: 28px;
            font-weight: bold;
            width: 60px;
            text-align: center;
        }

        .rank-1 .rank-number {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .rank-2 .rank-number {
            background: linear-gradient(135deg, #C0C0C0 0%, #A8A8A8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .rank-3 .rank-number {
            background: linear-gradient(135deg, #CD7F32 0%, #B87333 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .rank-other .rank-number {
            color: #667eea;
        }

        .model-info {
            flex: 1;
            margin-left: 20px;
        }

        .model-name-rank {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .model-stats {
            font-size: 13px;
            color: #999;
        }

        .score-bar {
            width: 200px;
            height: 35px;
            background: #e9ecef;
            border-radius: 18px;
            overflow: hidden;
            position: relative;
            margin-left: 20px;
        }

        .score-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 12px;
            color: white;
            font-size: 13px;
            font-weight: 700;
            transition: width 0.8s ease;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #999;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .tabs {
            display: flex;
            gap: 10px;
            border-bottom: 3px solid #e9ecef;
            margin-bottom: 30px;
        }

        .tab {
            padding: 12px 24px;
            border: none;
            background: none;
            font-size: 15px;
            font-weight: 600;
            color: #999;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            margin-bottom: -3px;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .info-box {
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
            font-size: 14px;
            color: #666;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            margin: 3% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 900px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 22px;
            font-weight: 600;
        }

        .modal-close {
            color: white;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            line-height: 1;
            padding: 0 8px;
        }

        .modal-close:hover {
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .eval-section {
            margin-bottom: 25px;
        }

        .eval-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #f0f0f0;
        }

        .eval-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .eval-info-item {
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }

        .eval-info-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 5px;
        }

        .eval-info-value {
            font-size: 15px;
            font-weight: 600;
            color: #333;
        }

        .dimension-scores {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .dimension-item {
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .dimension-name {
            font-size: 13px;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .dimension-score {
            font-size: 28px;
            font-weight: 700;
            color: #667eea;
        }

        .dimension-reasoning {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
            text-align: left;
        }

        .eval-text {
            font-size: 14px;
            line-height: 1.8;
            color: #333;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 10px 0;
        }

        .eval-list {
            list-style: none;
            padding: 0;
        }

        .eval-list li {
            padding: 8px 0 8px 25px;
            position: relative;
            font-size: 14px;
            line-height: 1.6;
            color: #555;
        }

        .eval-list li::before {
            content: 'â€¢';
            position: absolute;
            left: 10px;
            color: #667eea;
            font-weight: bold;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            flex-wrap: wrap;
            font-size: 13px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-box {
            width: 24px;
            height: 24px;
            border-radius: 4px;
        }

        /* è¯„ä¼°æ ‡å‡†æŠ˜å é¢æ¿ */
        .scoring-standard {
            background: white;
            margin: 0 40px 30px 40px;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .scoring-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 25px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .scoring-header:hover {
            background: linear-gradient(135deg, #5568d3 0%, #653a8b 100%);
        }

        .scoring-title {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .scoring-toggle {
            font-size: 24px;
            transition: transform 0.3s;
        }

        .scoring-toggle.open {
            transform: rotate(180deg);
        }

        .scoring-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out;
        }

        .scoring-content.open {
            max-height: 1000px;
            transition: max-height 0.5s ease-in;
        }

        .scoring-body {
            padding: 25px 30px;
        }

        .scoring-summary {
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
        }

        .scoring-summary h4 {
            color: #667eea;
            font-size: 15px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .weight-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .weight-item {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: #333;
        }

        .weight-dot {
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            margin-right: 10px;
        }

        .dimension-details {
            display: grid;
            gap: 20px;
        }

        .dimension-card {
            background: #f8f9fa;
            padding: 18px 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .dimension-card h5 {
            color: #667eea;
            font-size: 15px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .dimension-card p {
            font-size: 13px;
            line-height: 1.6;
            color: #555;
            margin: 0;
        }

        .score-scale {
            font-size: 12px;
            color: #999;
            margin-top: 8px;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .stats {
                grid-template-columns: 1fr 1fr;
            }

            .score-bar {
                width: 150px;
            }

            .modal-content {
                width: 95%;
                margin: 5% auto;
            }

            .scoring-standard {
                margin: 0 20px 20px 20px;
            }

            .scoring-body {
                padding: 20px;
            }

            .weight-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– äº¤å‰è¯„ä¼°ç»“æœæŸ¥çœ‹å™¨</h1>
            <p class="subtitle">8Ã—8æ¨¡å‹äº¤å‰è¯„ä¼° Â· 100åˆ†åˆ¶è¯„åˆ†</p>
        </div>

        <div class="patient-selector">
            <span class="selector-label">ğŸ“‹ é€‰æ‹©æ‚£è€…ï¼š</span>
            <div class="patient-buttons" id="patientButtons">
                <!-- æ‚£è€…æŒ‰é’®å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <div class="stats" id="statsContainer">
            <div class="stat-card">
                <div class="stat-label">è¯„ä¼°æ€»æ•°</div>
                <div class="stat-value" id="totalEvaluations">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">å¹³å‡åˆ†</div>
                <div class="stat-value" id="averageScore">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">æœ€é«˜åˆ†</div>
                <div class="stat-value" id="maxScore">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">æœ€ä½åˆ†</div>
                <div class="stat-value" id="minScore">-</div>
            </div>
        </div>

        <!-- è¯„ä¼°æ ‡å‡†æŠ˜å é¢æ¿ -->
        <div class="scoring-standard">
            <div class="scoring-header" onclick="toggleScoringStandard()">
                <div class="scoring-title">
                    ğŸ“‹ è¯„ä¼°æ ‡å‡†è¯¦æƒ…
                </div>
                <div class="scoring-toggle" id="scoringToggle">â–¼</div>
            </div>
            <div class="scoring-content" id="scoringContent">
                <div class="scoring-body">
                    <div class="scoring-summary">
                        <h4>ğŸ’¯ 100åˆ†åˆ¶è¯„åˆ†æ–¹æ¡ˆ</h4>
                        <div class="weight-list">
                            <div class="weight-item">
                                <div class="weight-dot"></div>
                                <span><strong>å‡†ç¡®æ€§</strong>ï¼šæœ€é«˜ 40 åˆ†</span>
                            </div>
                            <div class="weight-item">
                                <div class="weight-dot"></div>
                                <span><strong>é€»è¾‘æ€§</strong>ï¼šæœ€é«˜ 25 åˆ†</span>
                            </div>
                            <div class="weight-item">
                                <div class="weight-dot"></div>
                                <span><strong>å®Œæ•´æ€§</strong>ï¼šæœ€é«˜ 15 åˆ†</span>
                            </div>
                            <div class="weight-item">
                                <div class="weight-dot"></div>
                                <span><strong>æ ¼å¼è§„èŒƒæ€§</strong>ï¼šæœ€é«˜ 15 åˆ†</span>
                            </div>
                            <div class="weight-item">
                                <div class="weight-dot"></div>
                                <span><strong>è¯­è¨€è¡¨è¾¾</strong>ï¼šæœ€é«˜ 5 åˆ†</span>
                            </div>
                        </div>
                    </div>

                    <div class="dimension-details">
                        <div class="dimension-card">
                            <h5>1ï¸âƒ£ å‡†ç¡®æ€§ï¼ˆæ»¡åˆ†40åˆ†ï¼‰</h5>
                            <p>è¯„ä¼°æ—¶åºã€æ•°å€¼ã€äº‹å®çš„ä¸€è‡´æ€§ã€‚åŒ…æ‹¬ï¼šæ—¶é—´çº¿å‡†ç¡®æ€§ï¼ˆ15åˆ†ï¼‰ã€æ•°å€¼æ ¸å¯¹ï¼ˆ15åˆ†ï¼‰ã€äº‹å®ä¸€è‡´æ€§ï¼ˆ10åˆ†ï¼‰ã€‚æ£€æŸ¥æ—¶é—´é¡ºåºæ˜¯å¦æ­£ç¡®ã€æ•°å€¼æ˜¯å¦ä¸åŸæ–‡ä¸€è‡´ã€ç—‡çŠ¶å’Œç—…å²æ˜¯å¦å‡†ç¡®è®°å½•ã€‚</p>
                            <p class="score-scale">40åˆ†=å®Œå…¨å‡†ç¡® | 32åˆ†=åŸºæœ¬å‡†ç¡® | 24åˆ†=éƒ¨åˆ†å‡†ç¡® | 16åˆ†=è¾ƒå¤šé”™è¯¯ | 8åˆ†=ä¸¥é‡é”™è¯¯</p>
                        </div>

                        <div class="dimension-card">
                            <h5>2ï¸âƒ£ é€»è¾‘æ€§ï¼ˆæ»¡åˆ†25åˆ†ï¼‰</h5>
                            <p>è¯„ä¼°å› æœå…³ç³»å’Œæ¨ç†çš„åˆç†æ€§ã€‚åŒ…æ‹¬ï¼šå› æœåˆ¤æ–­å‡†ç¡®æ€§ã€æ¨ç†é“¾æ¡å®Œæ•´æ€§ã€å‰åé€»è¾‘ä¸€è‡´æ€§ã€‚æ£€æŸ¥ç—‡çŠ¶ä¸è¯Šæ–­ä¹‹é—´çš„é€»è¾‘å…³è”ã€æ²»ç–—æ–¹æ¡ˆçš„åˆç†æ€§ã€é¿å…å¼ºåŠ å› æœå…³ç³»ã€‚</p>
                            <p class="score-scale">25åˆ†=é€»è¾‘ä¸¥å¯† | 20åˆ†=é€»è¾‘åˆç† | 15åˆ†=åŸºæœ¬åˆç† | 10åˆ†=é€»è¾‘æ¬ ç¼º | 5åˆ†=é€»è¾‘æ··ä¹±</p>
                        </div>

                        <div class="dimension-card">
                            <h5>3ï¸âƒ£ å®Œæ•´æ€§ï¼ˆæ»¡åˆ†15åˆ†ï¼‰</h5>
                            <p>è¯„ä¼°ä¿¡æ¯è¦†ç›–åº¦å’Œå¿…è¦ä¿¡æ¯çš„ç¼ºå¤±æƒ…å†µã€‚åŒ…æ‹¬ï¼šå…³é”®ä¿¡æ¯å®Œæ•´æ€§ã€ç»†èŠ‚æè¿°å……åˆ†æ€§ã€è¯ç‰©å‰‚é‡å‡†ç¡®æ€§ã€‚æ£€æŸ¥ä¸»è¯‰ã€ç°ç—…å²ã€æ—¢å¾€å²ã€å®¶æ—å²ç­‰å¿…è¦å…ƒç´ æ˜¯å¦å®Œæ•´è®°å½•ã€‚</p>
                            <p class="score-scale">15åˆ†=ä¿¡æ¯å®Œæ•´ | 12åˆ†=è½»å¾®é—æ¼ | 9åˆ†=éƒ¨åˆ†ç¼ºå¤± | 6åˆ†=é‡è¦ä¿¡æ¯ç¼ºå¤± | 3åˆ†=ä¸¥é‡ä¸å®Œæ•´</p>
                        </div>

                        <div class="dimension-card">
                            <h5>4ï¸âƒ£ æ ¼å¼è§„èŒƒæ€§ï¼ˆæ»¡åˆ†15åˆ†ï¼‰</h5>
                            <p>è¯„ä¼°ç»“æ„ã€åˆ†ç±»ã€æ ‡å‡†åŒ–ç¨‹åº¦ã€‚åŒ…æ‹¬ï¼šç« èŠ‚ç»“æ„åˆç†æ€§ã€ä¿¡æ¯åˆ†ç±»å‡†ç¡®æ€§ã€åŒ»ç–—æ–‡ä¹¦è§„èŒƒæ€§ã€‚æ£€æŸ¥ç—…å²å½’ç±»æ˜¯å¦æ­£ç¡®ï¼ˆå¦‚æ…¢æ€§ç—…å²åº”å½’å…¥æ—¢å¾€å²ï¼‰ã€æ ¼å¼æ˜¯å¦ç»Ÿä¸€ã€å†…å®¹ç»„ç»‡æ˜¯å¦æ¸…æ™°ã€‚</p>
                            <p class="score-scale">15åˆ†=å®Œå…¨è§„èŒƒ | 12åˆ†=åŸºæœ¬è§„èŒƒ | 9åˆ†=éƒ¨åˆ†ä¸è§„èŒƒ | 6åˆ†=æ ¼å¼æ··ä¹± | 3åˆ†=ä¸¥é‡ä¸è§„èŒƒ</p>
                        </div>

                        <div class="dimension-card">
                            <h5>5ï¸âƒ£ è¯­è¨€è¡¨è¾¾ï¼ˆæ»¡åˆ†5åˆ†ï¼‰</h5>
                            <p>è¯„ä¼°ä¸“ä¸šæ€§ã€ç®€æ´æ€§ã€å¯è¯»æ€§ã€‚åŒ…æ‹¬ï¼šåŒ»å­¦æœ¯è¯­ä½¿ç”¨è§„èŒƒæ€§ã€è¡¨è¿°å‡†ç¡®æ€§ã€è¯­å¥é€šé¡ºåº¦ã€‚æ£€æŸ¥æ˜¯å¦ä½¿ç”¨è§„èŒƒçš„åŒ»å­¦æœ¯è¯­ã€è¡¨è¾¾æ˜¯å¦æ¸…æ™°ç®€æ´ã€æ˜¯å¦é¿å…æ¨¡ç³Šå’Œå†—ä½™ã€‚</p>
                            <p class="score-scale">5åˆ†=è¡¨è¾¾ä¼˜ç§€ | 4åˆ†=è¡¨è¾¾è‰¯å¥½ | 3åˆ†=è¡¨è¾¾ä¸€èˆ¬ | 2åˆ†=è¡¨è¾¾æ¬ ä½³ | 1åˆ†=è¡¨è¾¾æ··ä¹±</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('matrix')">ğŸ“Š è¯„åˆ†çŸ©é˜µ</button>
                <button class="tab" onclick="switchTab('ranking')">ğŸ† æ¨¡å‹æ’å</button>
            </div>

            <div id="matrixTab" class="tab-content active">
                <div class="section">
                    <h2 class="section-title">è¯„åˆ†çŸ©é˜µçƒ­åŠ›å›¾ï¼ˆå«ç»Ÿè®¡æ•°æ®ï¼‰</h2>
                    <div class="info-box">
                        ğŸ“‹ è¯´æ˜ï¼šé‡‡ç”¨<strong>100åˆ†åˆ¶è¯„åˆ†</strong>ï¼ˆå‡†ç¡®æ€§40åˆ† + é€»è¾‘æ€§25åˆ† + å®Œæ•´æ€§15åˆ† + æ ¼å¼è§„èŒƒæ€§15åˆ† + è¯­è¨€è¡¨è¾¾5åˆ†ï¼‰ã€‚è¡Œè¡¨ç¤ºè¢«è¯„ä¼°æ¨¡å‹ï¼Œåˆ—è¡¨ç¤ºè¯„ä¼°è€…ã€‚<strong>ç»¿è‰²é«˜äº®</strong>ä¸ºæœ€é«˜åˆ†ï¼Œ<strong>çº¢è‰²é«˜äº®</strong>ä¸ºæœ€ä½åˆ†ã€‚ç‚¹å‡»åˆ†æ•°æŸ¥çœ‹è¯¦ç»†è¯„ä¼°å†…å®¹ã€‚
                    </div>
                    <div class="matrix-container" id="matrixContainer">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <p>åŠ è½½è¯„åˆ†çŸ©é˜µä¸­...</p>
                        </div>
                    </div>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-box score-highest"></div>
                            <span>æœ€é«˜åˆ†</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-box score-high"></div>
                            <span>é«˜åˆ† (â‰¥80)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-box score-medium"></div>
                            <span>ä¸­ç­‰ (60-80)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-box score-low"></div>
                            <span>ä½åˆ† (<60)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-box score-lowest"></div>
                            <span>æœ€ä½åˆ†</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="rankingTab" class="tab-content">
                <div class="section">
                    <h2 class="section-title">æ¨¡å‹ç»¼åˆæ’å</h2>
                    <div class="info-box">
                        ğŸ† è¯´æ˜ï¼šæ ¹æ®å„æ¨¡å‹è¢«æ‰€æœ‰è¯„ä¼°è€…è¯„åˆ†çš„å¹³å‡å€¼è¿›è¡Œæ’åï¼ˆ100åˆ†åˆ¶è¯„åˆ†ï¼‰ï¼Œåˆ†æ•°è¶Šé«˜è¡¨ç¤ºç”Ÿæˆçš„åŒ»ç–—æŠ¥å‘Šè´¨é‡è¶Šå¥½ã€‚
                    </div>
                    <div class="ranking-list" id="rankingContainer">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <p>åŠ è½½æ’åæ•°æ®ä¸­...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è¯„ä¼°è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="evalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">è¯„ä¼°è¯¦æƒ…</div>
                <span class="modal-close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- è¯¦æƒ…å†…å®¹å°†åŠ¨æ€åŠ è½½ -->
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€æ•°æ®
        let currentData = null;
        let matrixData = null;
        let currentPatient = 'global';
        let allEvaluationData = {}; // å­˜å‚¨æ‰€æœ‰è¯„ä¼°è¯¦æƒ…

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
            initializePage();
        });

        async function initializePage() {
            try {
                // åŠ è½½çŸ©é˜µæ•°æ®
                matrixData = await loadMatrixData();

                if (matrixData) {
                    // ç”Ÿæˆæ‚£è€…æŒ‰é’®
                    renderPatientButtons();

                    // åŠ è½½å…¨å±€æ•°æ®
                    await loadData('global');
                } else {
                    showError('æ— æ³•åŠ è½½è¯„ä¼°æ•°æ®ï¼Œè¯·ç¡®ä¿ cross_evaluation_matrix.json æ–‡ä»¶å­˜åœ¨');
                }
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                showError('åˆå§‹åŒ–å¤±è´¥: ' + error.message);
            }
        }

        function renderPatientButtons() {
            const container = document.getElementById('patientButtons');

            // å…¨å±€æŒ‰é’®
            let html = `<button class="patient-btn active" onclick="selectPatient('global')">å…¨å±€å¹³å‡</button>`;

            // å„æ‚£è€…æŒ‰é’®
            matrixData.patients.forEach(patient => {
                html += `<button class="patient-btn" onclick="selectPatient('${patient}')">${patient}</button>`;
            });

            container.innerHTML = html;
        }

        function selectPatient(patient) {
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.patient-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // åŠ è½½æ•°æ®
            currentPatient = patient;
            loadData(patient);
        }

        async function loadMatrixData() {
            try {
                const response = await fetch('../../output/cross_evaluation_matrix.json');
                if (response.ok) {
                    return await response.json();
                }
                return null;
            } catch (error) {
                console.error('åŠ è½½çŸ©é˜µæ•°æ®å¤±è´¥:', error);
                return null;
            }
        }

        async function loadData(patient) {
            console.log(`åŠ è½½æ•°æ®: ${patient}`);

            try {
                let matrix;

                if (patient === 'global') {
                    matrix = matrixData.global_matrix;
                } else {
                    matrix = matrixData.matrices[patient];
                }

                if (!matrix) {
                    showError('æœªæ‰¾åˆ°è¯¥æ‚£è€…çš„æ•°æ®');
                    return;
                }

                // è½¬æ¢æ•°æ®æ ¼å¼
                currentData = transformMatrixData(matrix, patient === 'global');

                // æ¸²æŸ“æ‰€æœ‰è§†å›¾
                renderAllViews();

            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                showError('åŠ è½½æ•°æ®å¤±è´¥: ' + error.message);
            }
        }

        function transformMatrixData(matrix, isGlobal) {
            const models = matrixData.models;
            const transformedMatrix = {};

            models.forEach(generated => {
                transformedMatrix[generated] = {};
                models.forEach(evaluator => {
                    const cellData = matrix[generated]?.[evaluator];

                    if (cellData) {
                        if (isGlobal) {
                            transformedMatrix[generated][evaluator] = {
                                average_score: cellData.average,
                                count: cellData.count,
                                min: cellData.min,
                                max: cellData.max
                            };
                        } else {
                            transformedMatrix[generated][evaluator] = {
                                average_score: cellData
                            };
                        }
                    } else {
                        transformedMatrix[generated][evaluator] = null;
                    }
                });
            });

            // è®¡ç®—ç»Ÿè®¡æ•°æ®
            const statistics = calculateStatistics(transformedMatrix, models);

            return {
                models: models,
                matrix: transformedMatrix,
                statistics: statistics
            };
        }

        function calculateStatistics(matrix, models) {
            const allScores = [];
            models.forEach(generated => {
                models.forEach(evaluator => {
                    if (matrix[generated]?.[evaluator]?.average_score) {
                        allScores.push(matrix[generated][evaluator].average_score);
                    }
                });
            });

            if (allScores.length === 0) {
                return { total: 0, average: 0, max: 0, min: 0 };
            }

            return {
                total: allScores.length,
                average: (allScores.reduce((a, b) => a + b, 0) / allScores.length).toFixed(2),
                max: Math.max(...allScores).toFixed(2),
                min: Math.min(...allScores).toFixed(2),
                highest: Math.max(...allScores),
                lowest: Math.min(...allScores)
            };
        }

        function calculateRowStats(model) {
            const scores = [];
            currentData.models.forEach(evaluator => {
                const score = currentData.matrix[model]?.[evaluator];
                if (score?.average_score) {
                    scores.push(score.average_score);
                }
            });

            if (scores.length === 0) return { mean: 0, std: 0 };

            const mean = scores.reduce((a, b) => a + b, 0) / scores.length;
            const variance = scores.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / scores.length;
            const std = Math.sqrt(variance);

            return { mean: mean.toFixed(2), std: std.toFixed(2) };
        }


        function renderAllViews() {
            renderMatrix();
            renderRanking();
            updateStats();
        }

        function renderMatrix() {
            const container = document.getElementById('matrixContainer');
            const models = currentData.models;
            const matrix = currentData.matrix;
            const stats = currentData.statistics;

            let html = '<table class="matrix-table">';

            // è¡¨å¤´
            html += '<tr><th>è¢«è¯„ä¼°è€… â†“<br>è¯„ä¼°è€… â†’</th>';
            models.forEach(model => {
                html += `<th>${getShortModelName(model)}</th>`;
            });
            html += '<th class="summary-header">è¡Œå¹³å‡</th>';
            html += '<th class="summary-header">è¡Œæ ‡å‡†å·®</th>';
            html += '</tr>';

            // æ•°æ®è¡Œ
            models.forEach(generated => {
                html += '<tr>';
                html += `<td class="model-name">${getShortModelName(generated)}</td>`;

                models.forEach(evaluator => {
                    const score = matrix[generated]?.[evaluator];

                    if (score === null || !score) {
                        html += '<td class="self-eval">-</td>';
                    } else {
                        const scoreValue = score.average_score;
                        let colorClass = scoreValue >= 80 ? 'score-high' :
                                         scoreValue >= 60 ? 'score-medium' : 'score-low';

                        // æ ‡è®°æœ€é«˜åˆ†å’Œæœ€ä½åˆ†
                        if (scoreValue === stats.highest) {
                            colorClass = 'score-highest';
                        } else if (scoreValue === stats.lowest) {
                            colorClass = 'score-lowest';
                        }

                        html += `<td class="score-cell ${colorClass}"
                                    onclick="showEvalDetail('${generated}', '${evaluator}')"
                                    title="ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…">
                                    ${scoreValue.toFixed(2)}
                                </td>`;
                    }
                });

                // è¡Œç»Ÿè®¡
                const rowStats = calculateRowStats(generated);
                html += `<td class="summary-cell">${rowStats.mean}</td>`;
                html += `<td class="summary-cell">Â±${rowStats.std}</td>`;
                html += '</tr>';
            });

            html += '</table>';
            container.innerHTML = html;
        }

        function renderRanking() {
            const container = document.getElementById('rankingContainer');
            const models = currentData.models;
            const matrix = currentData.matrix;

            // è®¡ç®—æ¯ä¸ªæ¨¡å‹è¢«è¯„ä¼°çš„å¹³å‡åˆ†
            const rankings = models.map(model => {
                const scores = [];
                models.forEach(evaluator => {
                    if (matrix[model]?.[evaluator]?.average_score) {
                        scores.push(matrix[model][evaluator].average_score);
                    }
                });

                const avg = scores.length > 0 ?
                    scores.reduce((a, b) => a + b, 0) / scores.length : 0;

                return {
                    model: model,
                    average: avg,
                    count: scores.length
                };
            });

            // æ’åº
            rankings.sort((a, b) => b.average - a.average);

            // æ¸²æŸ“
            let html = '';
            rankings.forEach((item, index) => {
                const rank = index + 1;
                const rankClass = rank <= 3 ? `rank-${rank}` : 'rank-other';
                const percentage = item.average; // 100åˆ†åˆ¶ï¼Œç›´æ¥ä½¿ç”¨åˆ†æ•°ä½œä¸ºç™¾åˆ†æ¯”

                html += `
                    <div class="ranking-item ${rankClass}">
                        <div class="rank-number">${rank}</div>
                        <div class="model-info">
                            <div class="model-name-rank">${item.model}</div>
                            <div class="model-stats">è¢«è¯„ä¼° ${item.count} æ¬¡</div>
                        </div>
                        <div class="score-bar">
                            <div class="score-fill" style="width: ${percentage}%">
                                ${item.average.toFixed(2)}
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function updateStats() {
            const stats = currentData.statistics;

            document.getElementById('totalEvaluations').textContent = stats.total;
            document.getElementById('averageScore').textContent = stats.average;
            document.getElementById('maxScore').textContent = stats.max;
            document.getElementById('minScore').textContent = stats.min;
        }

        async function showEvalDetail(generated, evaluator) {
            const modal = document.getElementById('evalModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            // è®¾ç½®æ ‡é¢˜
            modalTitle.textContent = `${generated} è¢« ${evaluator} è¯„ä¼°`;

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            modalBody.innerHTML = '<div class="loading"><div class="loading-spinner"></div><p>åŠ è½½è¯„ä¼°è¯¦æƒ…...</p></div>';
            modal.style.display = 'block';

            try {
                // åŠ è½½è¯„ä¼°è¯¦æƒ…
                const evalData = await loadEvaluationDetail(currentPatient, generated, evaluator);

                if (evalData) {
                    modalBody.innerHTML = renderEvalDetail(evalData);
                } else {
                    modalBody.innerHTML = '<p style="text-align:center; padding: 40px; color: #999;">æš‚æ— è¯¦ç»†è¯„ä¼°æ•°æ®</p>';
                }
            } catch (error) {
                console.error('åŠ è½½è¯„ä¼°è¯¦æƒ…å¤±è´¥:', error);
                modalBody.innerHTML = '<p style="text-align:center; padding: 40px; color: #f44336;">åŠ è½½å¤±è´¥: ' + error.message + '</p>';
            }
        }

        async function loadEvaluationDetail(patient, generated, evaluator) {
            // å¦‚æœæ˜¯å…¨å±€ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªæ‚£è€…çš„æ•°æ®
            if (patient === 'global') {
                patient = 'æ‚£è€…1'; // é»˜è®¤æ˜¾ç¤ºæ‚£è€…1çš„æ•°æ®
            }

            // æ„å»ºæ–‡ä»¶å (æ¨¡å‹åå·²ç»æ˜¯ä¸‹åˆ’çº¿æ ¼å¼ï¼Œæ— éœ€æ›¿æ¢)
            const filename = `${generated}_by_${evaluator}_${patient}_aggregated.json`;
            const path = `../../output/cross_evaluation_results/${patient}/${filename}`;

            try {
                const response = await fetch(path);
                if (response.ok) {
                    return await response.json();
                }
                return null;
            } catch (error) {
                console.error('åŠ è½½è¯„ä¼°æ–‡ä»¶å¤±è´¥:', path, error);
                return null;
            }
        }

        function renderEvalDetail(data) {
            let html = '<div class="eval-section">';

            // ç›´æ¥ä½¿ç”¨total_score
            const totalScore = data.total_score || 0;

            // åŸºæœ¬ä¿¡æ¯
            html += '<div class="eval-section-title">ğŸ“Š è¯„åˆ†æ€»è§ˆ</div>';
            html += '<div class="eval-info-grid">';
            html += `<div class="eval-info-item">
                        <div class="eval-info-label">æ€»åˆ†ï¼ˆ100åˆ†åˆ¶ï¼‰</div>
                        <div class="eval-info-value">${totalScore.toFixed(2)}</div>
                     </div>`;
            html += `<div class="eval-info-item">
                        <div class="eval-info-label">æ„æˆ</div>
                        <div class="eval-info-value" style="font-size: 12px;">å‡†ç¡®æ€§40 + é€»è¾‘æ€§25 + å®Œæ•´æ€§15 + æ ¼å¼è§„èŒƒæ€§15 + è¯­è¨€è¡¨è¾¾5</div>
                     </div>`;
            html += '</div>';

            // å„ç»´åº¦è¯„åˆ†
            if (data.dimensions) {
                html += '<div class="eval-section-title">ğŸ“ˆ å„ç»´åº¦å¾—åˆ†</div>';
                html += '<div class="dimension-scores">';

                // ç»´åº¦é¡ºåºï¼ˆæŒ‰é‡è¦æ€§æ’åºï¼‰
                const dimensionOrder = ['å‡†ç¡®æ€§', 'é€»è¾‘æ€§', 'å®Œæ•´æ€§', 'æ ¼å¼è§„èŒƒæ€§', 'è¯­è¨€è¡¨è¾¾'];

                dimensionOrder.forEach(dimName => {
                    if (data.dimensions[dimName]) {
                        const dimData = data.dimensions[dimName];
                        const score = dimData.score || 0;
                        const maxScore = dimData.max_score || 100;
                        const issues = dimData.issues || '';

                        html += `
                            <div class="dimension-item">
                                <div class="dimension-name">${dimName}</div>
                                <div class="dimension-score">${score}/${maxScore}</div>
                                ${issues ? `<div class="dimension-reasoning">${issues}</div>` : ''}
                            </div>
                        `;
                    }
                });

                html += '</div>';
            }

            // å…³é”®åé¦ˆ
            if (data.critical_feedbacks && data.critical_feedbacks.length > 0) {
                html += '<div class="eval-section-title">âš ï¸ å…³é”®é—®é¢˜åé¦ˆ</div>';
                html += '<ul class="eval-list">';
                data.critical_feedbacks.forEach(feedback => {
                    html += `<li>${feedback}</li>`;
                });
                html += '</ul>';
            }

            html += '</div>';
            return html;
        }

        function closeModal() {
            document.getElementById('evalModal').style.display = 'none';
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modal = document.getElementById('evalModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        function switchTab(tabName) {
            // éšè—æ‰€æœ‰tabå†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // ç§»é™¤æ‰€æœ‰tabçš„activeç±»
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„tab
            document.getElementById(tabName + 'Tab').classList.add('active');

            // æ¿€æ´»å¯¹åº”çš„tabæŒ‰é’®
            event.target.classList.add('active');
        }

        function getShortModelName(model) {
            return model
                .replace('moonshotai_', '')
                .replace('deepseek_', '')
                .replace('-seed-1-6-251015', '');
        }

        function showError(message) {
            document.getElementById('matrixContainer').innerHTML = `
                <div style="text-align: center; padding: 40px; color: #f44336;">
                    <h3>âŒ é”™è¯¯</h3>
                    <p>${message}</p>
                </div>
            `;
        }

        function toggleScoringStandard() {
            const content = document.getElementById('scoringContent');
            const toggle = document.getElementById('scoringToggle');

            content.classList.toggle('open');
            toggle.classList.toggle('open');
        }
    </script>
</body>
</html>
