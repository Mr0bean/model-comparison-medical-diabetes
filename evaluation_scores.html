<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº¤å‰è¯„ä¼°åˆ†æ•°å±•ç¤ºç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .container {
            width: 100%;
            min-height: 100vh;
            margin: 0;
            background: white;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
            position: relative;
        }


        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header .subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px 25px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
        }

        .content {
            padding: 30px 40px;
        }

        .section {
            margin-bottom: 40px;
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .section-title {
            font-size: 22px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .ranking-table thead {
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
        }

        .ranking-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #667eea;
            font-size: 14px;
            border-bottom: 2px solid #667eea;
        }

        .ranking-table td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }

        .ranking-table tbody tr:hover {
            background: #f8f9ff;
        }

        .rank-medal {
            display: inline-block;
            width: 28px;
            height: 28px;
            line-height: 28px;
            text-align: center;
            border-radius: 50%;
            font-weight: 700;
            font-size: 14px;
        }

        .rank-1 {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: white;
        }

        .rank-2 {
            background: linear-gradient(135deg, #C0C0C0 0%, #A8A8A8 100%);
            color: white;
        }

        .rank-3 {
            background: linear-gradient(135deg, #CD7F32 0%, #B87333 100%);
            color: white;
        }

        .rank-other {
            background: #f0f0f0;
            color: #666;
        }

        .score-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 15px;
        }

        .score-excellent {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
        }

        .score-good {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
        }

        .score-average {
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            color: white;
        }

        .score-poor {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            color: white;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 1024px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        .info-card {
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .info-card-title {
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 10px;
        }

        .info-card-content {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }

        .filter-bar {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-label {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        .filter-select {
            padding: 8px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-select:hover {
            border-color: #667eea;
        }

        .filter-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .matrix-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        .evaluation-matrix {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
            font-size: 13px;
        }

        .evaluation-matrix th,
        .evaluation-matrix td {
            padding: 10px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        .evaluation-matrix thead th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .evaluation-matrix tbody th {
            background: #f8f9ff;
            color: #667eea;
            font-weight: 600;
            text-align: left;
            position: sticky;
            left: 0;
            z-index: 5;
        }

        .matrix-cell {
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .matrix-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .loading {
            text-align: center;
            padding: 60px;
            font-size: 18px;
            color: #999;
        }

        .loading::after {
            content: '...';
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            display: none;
            white-space: nowrap;
        }

        .count-badge {
            display: inline-block;
            background: #e0e0e0;
            color: #666;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ† äº¤å‰è¯„ä¼°åˆ†æ•°å±•ç¤ºç³»ç»Ÿ</h1>
            <div class="subtitle">åŸºäº640ä¸ªå®Œæ•´è¯„ä¼°çš„ç»¼åˆåˆ†æ</div>
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-label">æ€»è¯„ä¼°æ•°</div>
                    <div class="stat-value" id="totalEvaluations">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">æœ‰æ•ˆè¯„ä¼°</div>
                    <div class="stat-value" id="validEvaluations">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å¹³å‡åˆ†</div>
                    <div class="stat-value" id="averageScore">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å®Œæˆç‡</div>
                    <div class="stat-value" id="completionRate">-</div>
                </div>
            </div>
        </div>

        <div class="content" id="mainContent">
            <div class="loading">æ­£åœ¨åŠ è½½è¯„ä¼°æ•°æ®</div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // ä»localStorageåŠ è½½æ•°æ®
        async function loadEvaluationData() {
            const reportData = localStorage.getItem('FINAL_COMPLETE_640_REPORT_V2');

            if (!reportData) {
                // å¦‚æœlocalStorageæ²¡æœ‰æ•°æ®ï¼Œå°è¯•åŠ è½½JSONæ–‡ä»¶
                try {
                    const response = await fetch('FINAL_COMPLETE_640_REPORT_V2.json');
                    const data = await response.json();
                    localStorage.setItem('FINAL_COMPLETE_640_REPORT_V2', JSON.stringify(data));
                    return data;
                } catch (error) {
                    console.error('Failed to load evaluation data:', error);
                    return null;
                }
            }

            return JSON.parse(reportData);
        }

        function getScoreBadgeClass(score) {
            if (score >= 4.0) return 'score-excellent';
            if (score >= 3.5) return 'score-good';
            if (score >= 3.0) return 'score-average';
            return 'score-poor';
        }

        function getRankMedalClass(rank) {
            if (rank === 1) return 'rank-1';
            if (rank === 2) return 'rank-2';
            if (rank === 3) return 'rank-3';
            return 'rank-other';
        }

        function renderHeader(data) {
            document.getElementById('totalEvaluations').textContent = data.total_evaluations || '-';
            document.getElementById('validEvaluations').textContent = data.valid_evaluations || '-';
            document.getElementById('averageScore').textContent = data.overall_statistics?.mean.toFixed(2) || '-';
            document.getElementById('completionRate').textContent = data.completion_status || '-';
        }

        function renderModelRankings(data) {
            const rankings = data.model_rankings || [];

            let html = `
                <h3 class="section-title">æ¨¡å‹è´¨é‡æ’å</h3>
                <div class="info-card">
                    <div class="info-card-title">ğŸ“Š è¯´æ˜</div>
                    <div class="info-card-content">
                        ä»¥ä¸‹æ˜¯å„æ¨¡å‹ä½œä¸º<strong>è¢«è¯„ä¼°è€…</strong>æ—¶è·å¾—çš„å¹³å‡åˆ†æ•°æ’åï¼Œåˆ†æ•°è¶Šé«˜è¡¨ç¤ºç”Ÿæˆçš„åŒ»ç–—æŠ¥å‘Šè´¨é‡è¶Šå¥½ã€‚
                    </div>
                </div>
                <table class="ranking-table">
                    <thead>
                        <tr>
                            <th>æ’å</th>
                            <th>æ¨¡å‹åç§°</th>
                            <th>å¹³å‡åˆ†</th>
                            <th>æ ‡å‡†å·®</th>
                            <th>è¯„ä¼°æ¬¡æ•°</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            rankings.forEach((item, index) => {
                const rank = index + 1;
                const medalClass = getRankMedalClass(rank);
                const scoreClass = getScoreBadgeClass(item.average);

                html += `
                    <tr>
                        <td><span class="rank-medal ${medalClass}">${rank}</span></td>
                        <td><strong>${item.model}</strong></td>
                        <td><span class="score-badge ${scoreClass}">${item.average.toFixed(2)}</span></td>
                        <td>Â±${item.std.toFixed(2)}</td>
                        <td>${item.count} <span class="count-badge">æ¬¡</span></td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            return html;
        }

        function renderEvaluatorStats(data) {
            const evaluators = data.evaluator_rankings || [];

            let html = `
                <h3 class="section-title">è¯„ä¼°è€…è¯„åˆ†å€¾å‘</h3>
                <div class="info-card">
                    <div class="info-card-title">ğŸ“‹ è¯´æ˜</div>
                    <div class="info-card-content">
                        ä»¥ä¸‹æ˜¯å„æ¨¡å‹ä½œä¸º<strong>è¯„ä¼°è€…</strong>æ—¶ç»™å‡ºçš„å¹³å‡åˆ†æ•°ï¼Œåæ˜ äº†ä¸åŒè¯„ä¼°è€…çš„è¯„åˆ†å€¾å‘ï¼ˆä¸¥æ ¼æˆ–å®½æ¾ï¼‰ã€‚
                    </div>
                </div>
                <table class="ranking-table">
                    <thead>
                        <tr>
                            <th>æ’å</th>
                            <th>è¯„ä¼°è€…</th>
                            <th>ç»™åˆ†å‡å€¼</th>
                            <th>æ ‡å‡†å·®</th>
                            <th>è¯„ä¼°æ¬¡æ•°</th>
                            <th>è¯„åˆ†å€¾å‘</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            evaluators.forEach((item, index) => {
                const rank = index + 1;
                const scoreClass = getScoreBadgeClass(item.average);
                let tendency = '';
                if (item.average >= 4.0) tendency = 'å®½æ¾';
                else if (item.average >= 3.5) tendency = 'é€‚ä¸­';
                else if (item.average >= 3.0) tendency = 'åä¸¥';
                else tendency = 'ä¸¥æ ¼';

                html += `
                    <tr>
                        <td><span class="rank-medal rank-other">${rank}</span></td>
                        <td><strong>${item.evaluator}</strong></td>
                        <td><span class="score-badge ${scoreClass}">${item.average.toFixed(2)}</span></td>
                        <td>Â±${item.std.toFixed(2)}</td>
                        <td>${item.count} <span class="count-badge">æ¬¡</span></td>
                        <td>${tendency}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            return html;
        }

        function renderCharts(data) {
            const stats = data.overall_statistics || {};

            return `
                <h3 class="section-title">åˆ†æ•°åˆ†å¸ƒå›¾è¡¨</h3>
                <div class="grid-2">
                    <div class="chart-container">
                        <canvas id="modelChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="evaluatorChart"></canvas>
                    </div>
                </div>
            `;
        }

        function drawCharts(data) {
            // æ¨¡å‹æ’åå›¾è¡¨
            const modelCtx = document.getElementById('modelChart');
            if (modelCtx) {
                const modelRankings = data.model_rankings || [];
                new Chart(modelCtx, {
                    type: 'bar',
                    data: {
                        labels: modelRankings.map(m => m.model),
                        datasets: [{
                            label: 'å¹³å‡åˆ†',
                            data: modelRankings.map(m => m.average),
                            backgroundColor: 'rgba(102, 126, 234, 0.8)',
                            borderColor: 'rgba(102, 126, 234, 1)',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'æ¨¡å‹è´¨é‡æ’å',
                                font: { size: 16, weight: 'bold' }
                            },
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 5,
                                ticks: { stepSize: 0.5 }
                            }
                        }
                    }
                });
            }

            // è¯„ä¼°è€…è¯„åˆ†å€¾å‘å›¾è¡¨
            const evalCtx = document.getElementById('evaluatorChart');
            if (evalCtx) {
                const evaluatorRankings = data.evaluator_rankings || [];
                new Chart(evalCtx, {
                    type: 'bar',
                    data: {
                        labels: evaluatorRankings.map(e => e.evaluator),
                        datasets: [{
                            label: 'å¹³å‡ç»™åˆ†',
                            data: evaluatorRankings.map(e => e.average),
                            backgroundColor: 'rgba(118, 75, 162, 0.8)',
                            borderColor: 'rgba(118, 75, 162, 1)',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'è¯„ä¼°è€…è¯„åˆ†å€¾å‘',
                                font: { size: 16, weight: 'bold' }
                            },
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 5,
                                ticks: { stepSize: 0.5 }
                            }
                        }
                    }
                });
            }
        }

        async function init() {
            const data = await loadEvaluationData();

            if (!data) {
                document.getElementById('mainContent').innerHTML = `
                    <div class="section">
                        <h3>âŒ æ•°æ®åŠ è½½å¤±è´¥</h3>
                        <p>è¯·ç¡®ä¿ FINAL_COMPLETE_640_REPORT_V2.json æ–‡ä»¶å­˜åœ¨ã€‚</p>
                    </div>
                `;
                return;
            }

            // æ¸²æŸ“é¡µçœ‰ç»Ÿè®¡
            renderHeader(data);

            // æ¸²æŸ“ä¸»è¦å†…å®¹
            let content = '<div class="section">' + renderModelRankings(data) + '</div>';
            content += '<div class="section">' + renderEvaluatorStats(data) + '</div>';
            content += '<div class="section">' + renderCharts(data) + '</div>';

            document.getElementById('mainContent').innerHTML = content;

            // ç»˜åˆ¶å›¾è¡¨
            setTimeout(() => drawCharts(data), 100);
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
