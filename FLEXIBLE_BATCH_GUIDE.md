# çµæ´»åˆ†æ‰¹æ‰§è¡ŒæŒ‡å—

## ğŸ¯ æ–°å¢çš„çµæ´»åˆ†æ‰¹è„šæœ¬

`run_flexible_batch.py` æä¾›äº†æ›´çµæ´»çš„åˆ†æ‰¹æ–¹å¼ã€‚

---

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### 1ï¸âƒ£ åŸºç¡€ç”¨æ³•ï¼šè‡ªå®šä¹‰æ‰¹æ¬¡å¤§å°

```bash
# æ¯æ‰¹2ä¸ªæ‚£è€…ï¼ˆæ‚£è€…1-10åˆ†ä¸º5æ‰¹ï¼‰
python run_flexible_batch.py --batch-size 2

# æ¯æ‰¹1ä¸ªæ‚£è€…ï¼ˆé€ä¸ªè¯„ä¼°ï¼‰
python run_flexible_batch.py --batch-size 1

# æ¯æ‰¹5ä¸ªæ‚£è€…ï¼ˆåˆ†ä¸º2æ‰¹ï¼‰
python run_flexible_batch.py --batch-size 5
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
æ€»æ‚£è€…æ•°: 10
æ‰¹æ¬¡å¤§å°: 2
æ€»æ‰¹æ¬¡æ•°: 5

æ‰¹æ¬¡åˆ’åˆ†:
  æ‰¹æ¬¡1: æ‚£è€…1, æ‚£è€…2
  æ‰¹æ¬¡2: æ‚£è€…3, æ‚£è€…4
  æ‰¹æ¬¡3: æ‚£è€…5, æ‚£è€…6
  æ‰¹æ¬¡4: æ‚£è€…7, æ‚£è€…8
  æ‰¹æ¬¡5: æ‚£è€…9, æ‚£è€…10
```

---

### 2ï¸âƒ£ åªæ‰§è¡Œç‰¹å®šæ‰¹æ¬¡

```bash
# åªæ‰§è¡Œç¬¬1æ‰¹
python run_flexible_batch.py --batch-size 3 --batch-index 1

# åªæ‰§è¡Œç¬¬2æ‰¹
python run_flexible_batch.py --batch-size 3 --batch-index 2
```

**åœºæ™¯**ï¼š
- âœ… åˆ†æ—¶æ®µæ‰§è¡Œï¼ˆä¸Šåˆæ‰§è¡Œæ‰¹æ¬¡1ï¼Œä¸‹åˆæ‰§è¡Œæ‰¹æ¬¡2ï¼‰
- âœ… ä¸­æ–­åç»§ç»­ï¼ˆæ‰¹æ¬¡1å®Œæˆäº†ï¼Œä»æ‰¹æ¬¡2å¼€å§‹ï¼‰
- âœ… æµ‹è¯•éªŒè¯ï¼ˆå…ˆæ‰§è¡Œç¬¬ä¸€æ‰¹çœ‹æ•ˆæœï¼‰

---

### 3ï¸âƒ£ æŒ‡å®šæ‚£è€…åˆ—è¡¨

```bash
# åªè¯„ä¼°éƒ¨åˆ†æ‚£è€…
python run_flexible_batch.py \
  --patients æ‚£è€…1 æ‚£è€…2 æ‚£è€…3 \
  --batch-size 1

# è·³è¿‡å·²å®Œæˆçš„æ‚£è€…
python run_flexible_batch.py \
  --patients æ‚£è€…5 æ‚£è€…6 æ‚£è€…7 æ‚£è€…8 \
  --batch-size 2
```

---

### 4ï¸âƒ£ æŒ‡å®šæ¨¡å‹ï¼ˆå‡å°‘è¯„ä¼°æ¬¡æ•°ï¼‰

```bash
# åªè®©4ä¸ªæ¨¡å‹äº’ç›¸è¯„ä¼°
python run_flexible_batch.py \
  --patients æ‚£è€…1 æ‚£è€…2 \
  --models gpt-5.1 deepseek/deepseek-v3.1 gemini-2.5-pro Baichuan-M2 \
  --batch-size 2

# é¢„è®¡: 2ä¸ªæ‚£è€… Ã— 4ä¸ªæ¨¡å‹ Ã— 4ä¸ªè¯„ä¼°è€… = 32æ¬¡è¯„ä¼°
```

**é€‚ç”¨åœºæ™¯**ï¼š
- å¿«é€Ÿæµ‹è¯•å°‘æ•°å‡ ä¸ªä¸»è¦æ¨¡å‹
- èµ„æºå—é™æ—¶å…ˆè¯„ä¼°é‡ç‚¹æ¨¡å‹
- æ¨¡å‹å¯¹æ¯”å®éªŒ

---

### 5ï¸âƒ£ è¯•è¿è¡Œæ¨¡å¼

```bash
# æŸ¥çœ‹ä¼šæ‰§è¡Œä»€ä¹ˆå‘½ä»¤ï¼Œä¸å®é™…è¿è¡Œ
python run_flexible_batch.py \
  --batch-size 2 \
  --dry-run
```

**è¾“å‡º**ï¼š
```
æ‰§è¡Œå‘½ä»¤: python run_cross_evaluation.py --patients æ‚£è€…1 æ‚£è€…2
æ‚£è€…: æ‚£è€…1, æ‚£è€…2
é¢„è®¡è¯„ä¼°: 2 Ã— 8 Ã— 8 = 128 æ¬¡
âš ï¸  è¯•è¿è¡Œæ¨¡å¼ï¼Œä¸å®é™…æ‰§è¡Œ
```

---

### 6ï¸âƒ£ è°ƒæ•´ç­‰å¾…æ—¶é—´

```bash
# æ‰¹æ¬¡é—´ç­‰å¾…10ç§’ï¼ˆé¿å…APIé™æµï¼‰
python run_flexible_batch.py \
  --batch-size 3 \
  --wait-time 10

# æ‰¹æ¬¡é—´ä¸ç­‰å¾…
python run_flexible_batch.py \
  --batch-size 3 \
  --wait-time 0
```

---

## ğŸš€ å®æˆ˜åœºæ™¯

### åœºæ™¯Aï¼šå¿«é€Ÿæµ‹è¯•ï¼ˆ10åˆ†é’Ÿï¼‰

```bash
# åªè¯„ä¼°2ä¸ªæ‚£è€…ï¼Œä½¿ç”¨2ä¸ªæ¨¡å‹
python run_flexible_batch.py \
  --patients æ‚£è€…1 æ‚£è€…2 \
  --models gpt-5.1 deepseek/deepseek-v3.1 \
  --batch-size 1

# é¢„è®¡: 2 Ã— 2 Ã— 2 = 8æ¬¡è¯„ä¼° â‰ˆ 10åˆ†é’Ÿ
```

---

### åœºæ™¯Bï¼šåˆ†æ—¶æ®µæ‰§è¡Œï¼ˆå·¥ä½œæ—¥ï¼‰

```bash
# ä¸Šåˆ9ç‚¹æ‰§è¡Œ
python run_flexible_batch.py --batch-size 2 --batch-index 1

# ä¸‹åˆ2ç‚¹æ‰§è¡Œ
python run_flexible_batch.py --batch-size 2 --batch-index 2

# ä¸‹åˆ5ç‚¹æ‰§è¡Œ
python run_flexible_batch.py --batch-size 2 --batch-index 3
```

---

### åœºæ™¯Cï¼šå¤œé—´å®Œæ•´æ‰§è¡Œ

```bash
# æ™šä¸Š9ç‚¹å¼€å§‹ï¼Œä¸€æ¬¡æ€§æ‰§è¡Œå®Œ
nohup python run_flexible_batch.py \
  --batch-size 5 \
  > batch_overnight.log 2>&1 &

# ç¬¬äºŒå¤©æ—©ä¸ŠæŸ¥çœ‹ç»“æœ
tail -100 batch_overnight.log
```

---

### åœºæ™¯Dï¼šä¸­æ–­åç»­æ‰§è¡Œ

```bash
# å‡è®¾æ‚£è€…1-4å·²å®Œæˆï¼Œä»æ‚£è€…5å¼€å§‹
python run_flexible_batch.py \
  --patients æ‚£è€…5 æ‚£è€…6 æ‚£è€…7 æ‚£è€…8 æ‚£è€…9 æ‚£è€…10 \
  --batch-size 3

# å°†åˆ†ä¸º2æ‰¹ï¼š
#   æ‰¹æ¬¡1: æ‚£è€…5,6,7
#   æ‰¹æ¬¡2: æ‚£è€…8,9,10
```

---

### åœºæ™¯Eï¼šé€ä¸ªæ‚£è€…æ‰§è¡Œï¼ˆæœ€ç¨³å¦¥ï¼‰

```bash
# æ¯æ‰¹åªåŒ…å«1ä¸ªæ‚£è€…
python run_flexible_batch.py --batch-size 1

# å¦‚æœæŸä¸ªæ‚£è€…å¤±è´¥ï¼Œä¸å½±å“å…¶ä»–æ‚£è€…
```

---

## ğŸ“Š æ‰¹æ¬¡å¤§å°å»ºè®®

| æ‰¹æ¬¡å¤§å° | APIè°ƒç”¨æ•° | é¢„è®¡æ—¶é—´ | é€‚ç”¨åœºæ™¯ |
|---------|----------|----------|----------|
| 1ä¸ªæ‚£è€… | 64æ¬¡ | 8-10åˆ†é’Ÿ | æµ‹è¯•ã€è°ƒè¯• |
| 2ä¸ªæ‚£è€… | 128æ¬¡ | 15-20åˆ†é’Ÿ | çŸ­æ—¶æ®µæ‰§è¡Œ |
| 3ä¸ªæ‚£è€… | 192æ¬¡ | 25-30åˆ†é’Ÿ | æ¨èé»˜è®¤ |
| 5ä¸ªæ‚£è€… | 320æ¬¡ | 40-50åˆ†é’Ÿ | é•¿æ—¶æ®µæ‰§è¡Œ |
| 10ä¸ªæ‚£è€… | 640æ¬¡ | 80-100åˆ†é’Ÿ | å®Œæ•´æ‰§è¡Œ |

---

## ğŸ” ç›‘æ§è¿›åº¦

### æ–¹æ³•1ï¼šå®æ—¶æŸ¥çœ‹æ—¥å¿—

```bash
# åå°æ‰§è¡Œ
nohup python run_flexible_batch.py --batch-size 3 > batch.log 2>&1 &

# å®æ—¶æŸ¥çœ‹
tail -f batch.log
```

### æ–¹æ³•2ï¼šç›‘æ§æ–‡ä»¶æ•°é‡

```bash
# æŒç»­ç›‘æ§å·²å®Œæˆçš„è¯„ä¼°æ•°é‡
watch -n 30 '
  echo "Rawæ–‡ä»¶: $(find output/cross_evaluation_results -name "*.json" -path "*/raw/*" | wc -l)"
  echo "è¯„ä¼°æ–‡ä»¶: $(find output/cross_evaluation_results -name "*.json" -path "*/evaluations/*" | wc -l)"
  echo "é¢„æœŸæ€»æ•°: 640"
'
```

### æ–¹æ³•3ï¼šæŸ¥çœ‹æœ€æ–°æ–‡ä»¶

```bash
# æŸ¥çœ‹æœ€è¿‘ç”Ÿæˆçš„5ä¸ªæ–‡ä»¶
find output/cross_evaluation_results -name "*.json" -type f -path "*/evaluations/*" \
  -exec ls -lt {} + | head -6
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### âœ… æ¨è

1. **å…ˆè¯•è¿è¡Œ**
   ```bash
   python run_flexible_batch.py --batch-size 3 --dry-run
   ```

2. **å°æ‰¹é‡æµ‹è¯•**
   ```bash
   python run_flexible_batch.py --batch-size 1 --batch-index 1
   ```

3. **å®šæœŸå¤‡ä»½**
   ```bash
   tar -czf backup_$(date +%Y%m%d).tar.gz output/cross_evaluation_results/
   ```

### âŒ é¿å…

1. âŒ ä¸è¦åŒæ—¶è¿è¡Œå¤šä¸ªæ‰¹æ¬¡è„šæœ¬ï¼ˆä¼šå†²çªï¼‰
2. âŒ ä¸è¦åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¿®æ”¹ä»£ç 
3. âŒ ä¸è¦åˆ é™¤ `output/cross_evaluation_results/` ç›®å½•

---

## ğŸ†š å¯¹æ¯”ï¼šä¸‰ç§æ‰¹æ¬¡è„šæœ¬

| è„šæœ¬ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| **run_batch_evaluation.py** | é¢„è®¾3ä¸ªæ‰¹æ¬¡ | æ ‡å‡†æµç¨‹ |
| **run_flexible_batch.py** | è‡ªå®šä¹‰æ‰¹æ¬¡å¤§å° | çµæ´»åˆ†æ‰¹ |
| **run_cross_evaluation.py** | æ‰‹åŠ¨æŒ‡å®šå‚æ•° | ç²¾ç¡®æ§åˆ¶ |

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æŸ¥çœ‹å·²å®Œæˆçš„æ‰¹æ¬¡ï¼Ÿ

```bash
# æŸ¥çœ‹å·²æœ‰çš„è¯„ä¼°æ–‡ä»¶
ls -d output/cross_evaluation_results/æ‚£è€…*/evaluations/ 2>/dev/null
```

### Q: å¦‚ä½•æ¢å¤ä¸­æ–­çš„æ‰§è¡Œï¼Ÿ

```bash
# æŸ¥çœ‹å“ªäº›æ‚£è€…å·²å®Œæˆ
for i in {1..10}; do
    count=$(find output/cross_evaluation_results/æ‚£è€…$i/evaluations/ -name "*.json" 2>/dev/null | wc -l)
    echo "æ‚£è€…$i: $count/64 ä¸ªè¯„ä¼°"
done

# åªæ‰§è¡Œæœªå®Œæˆçš„æ‚£è€…
python run_flexible_batch.py --patients æ‚£è€…5 æ‚£è€…6 æ‚£è€…7 --batch-size 3
```

### Q: å¦‚ä½•å–æ¶ˆæ­£åœ¨æ‰§è¡Œçš„æ‰¹æ¬¡ï¼Ÿ

```bash
# æŒ‰ Ctrl+C ä¸­æ­¢å½“å‰æ‰¹æ¬¡

# æˆ–è€…æ‰¾åˆ°è¿›ç¨‹å¹¶kill
ps aux | grep run_flexible_batch
kill <PID>
```

---

**ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¥æœŸ**: 2025-11-18
**é€‚ç”¨èŒƒå›´**: çµæ´»çš„æ‰¹æ¬¡æ‰§è¡Œéœ€æ±‚
