<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ»ç–—å¯¹è¯æµ‹è¯•ç»“æœå¯è§†åŒ–</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .meta-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .meta-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
        }

        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
        }

        select {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 200px;
        }

        select:hover {
            border-color: #667eea;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .content {
            display: flex;
            height: calc(100vh - 300px);
            min-height: 600px;
        }

        .sidebar {
            width: 400px;
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
            background: #fafafa;
        }

        .patient-info {
            padding: 20px;
            background: white;
            margin: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .patient-info h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #666;
            font-weight: 500;
        }

        .info-value {
            color: #333;
            font-weight: 600;
        }

        .conversation {
            padding: 20px;
            background: white;
            margin: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .conversation h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 15px;
            border-radius: 10px;
            line-height: 1.6;
            font-size: 14px;
        }

        .message.patient {
            background: #e3f2fd;
            margin-right: 20px;
        }

        .message.assistant {
            background: #f3e5f5;
            margin-left: 20px;
        }

        .message-label {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 12px;
            text-transform: uppercase;
        }

        .message.patient .message-label {
            color: #1976d2;
        }

        .message.assistant .message-label {
            color: #7b1fa2;
        }

        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        .prompt-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .prompt-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 16px;
            font-weight: 600;
        }

        .model-response {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .model-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .model-name {
            font-weight: 600;
            color: #667eea;
            font-size: 16px;
        }

        .timestamp {
            font-size: 12px;
            color: #999;
        }

        .response-content {
            line-height: 1.8;
            color: #333;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .error {
            color: #d32f2f;
            background: #ffebee;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #d32f2f;
        }

        .success-badge {
            display: inline-block;
            padding: 4px 10px;
            background: #4caf50;
            color: white;
            border-radius: 12px;
            font-size: 12px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }

        /* Markdownæ ·å¼ */
        .response-content h1,
        .response-content h2,
        .response-content h3 {
            margin-top: 20px;
            margin-bottom: 10px;
            color: #333;
        }

        .response-content h1 {
            font-size: 24px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .response-content h2 {
            font-size: 20px;
            color: #667eea;
        }

        .response-content h3 {
            font-size: 18px;
        }

        .response-content ul,
        .response-content ol {
            margin-left: 20px;
            margin-bottom: 10px;
        }

        .response-content li {
            margin-bottom: 5px;
        }

        .response-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .response-content table th,
        .response-content table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        .response-content table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .response-content table tr:nth-child(even) {
            background: #f9f9f9;
        }

        .response-content code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }

        .response-content blockquote {
            border-left: 4px solid #667eea;
            padding-left: 15px;
            margin: 15px 0;
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š åŒ»ç–—å¯¹è¯æµ‹è¯•ç»“æœå¯è§†åŒ–</h1>
            <div class="meta-info">
                <div class="meta-item">
                    <strong>æ—¶é—´ï¼š</strong><span id="timestamp">-</span>
                </div>
                <div class="meta-item">
                    <strong>æ‚£è€…æ•°ï¼š</strong><span id="totalPatients">-</span>
                </div>
                <div class="meta-item">
                    <strong>æ¨¡å‹æ•°ï¼š</strong><span id="totalModels">-</span>
                </div>
                <div class="meta-item">
                    <strong>æç¤ºè¯æ•°ï¼š</strong><span id="totalPrompts">-</span>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>é€‰æ‹©æ‚£è€…</label>
                <select id="patientSelect">
                    <option value="">åŠ è½½ä¸­...</option>
                </select>
            </div>
            <div class="control-group">
                <label>é€‰æ‹©åˆ†æä»»åŠ¡</label>
                <select id="promptSelect">
                    <option value="">è¯·å…ˆé€‰æ‹©æ‚£è€…</option>
                </select>
            </div>
            <div class="control-group">
                <label>é€‰æ‹©æ¨¡å‹</label>
                <select id="modelSelect">
                    <option value="all">å…¨éƒ¨æ¨¡å‹</option>
                </select>
            </div>
            <div style="margin-left: auto; padding: 10px; background: white; border-radius: 8px; font-size: 12px;">
                <div>å½“å‰çŠ¶æ€: <span id="debugStatus">ç­‰å¾…åŠ è½½...</span></div>
            </div>
        </div>

        <div class="content">
            <div class="sidebar">
                <div class="patient-info" id="patientInfo">
                    <h3>ğŸ‘¤ æ‚£è€…ä¿¡æ¯</h3>
                    <div class="loading">
                        <div class="spinner"></div>
                        è¯·é€‰æ‹©æ‚£è€…
                    </div>
                </div>

                <div class="conversation" id="conversationSection">
                    <h3>ğŸ’¬ å¯¹è¯è®°å½•</h3>
                    <div class="loading">
                        <div class="spinner"></div>
                        è¯·é€‰æ‹©æ‚£è€…
                    </div>
                </div>
            </div>

            <div class="main-content" id="mainContent">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>è¯·é€‰æ‹©æ‚£è€…å’Œåˆ†æä»»åŠ¡</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let testData = null;

        // åŠ è½½JSONæ•°æ®
        async function loadData() {
            try {
                const response = await fetch('batch_test_results_20251115_235808.json');
                testData = await response.json();
                initializeUI();
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                document.getElementById('mainContent').innerHTML = `
                    <div class="error">
                        <strong>âŒ åŠ è½½å¤±è´¥</strong><br>
                        æ— æ³•åŠ è½½æ•°æ®æ–‡ä»¶ï¼Œè¯·ç¡®ä¿ batch_test_results_20251115_235808.json æ–‡ä»¶åœ¨åŒä¸€ç›®å½•ä¸‹ã€‚
                    </div>
                `;
            }
        }

        // æ›´æ–°è°ƒè¯•çŠ¶æ€
        function updateDebugStatus() {
            const patientIndex = document.getElementById('patientSelect').value;
            const promptIndex = document.getElementById('promptSelect').value;
            const modelValue = document.getElementById('modelSelect').value;

            let status = '';
            if (!patientIndex) {
                status = 'æœªé€‰æ‹©æ‚£è€…';
            } else if (!promptIndex) {
                status = `å·²é€‰æ‚£è€…${patientIndex}ï¼Œæœªé€‰ä»»åŠ¡`;
            } else {
                status = `æ‚£è€…${patientIndex} | ä»»åŠ¡${promptIndex} | æ¨¡å‹${modelValue}`;
            }

            document.getElementById('debugStatus').textContent = status;
        }

        // åˆå§‹åŒ–UI
        function initializeUI() {
            if (!testData) return;

            // æ›´æ–°å…ƒæ•°æ®
            document.getElementById('timestamp').textContent = new Date(testData.meta.timestamp).toLocaleString('zh-CN');
            document.getElementById('totalPatients').textContent = testData.meta.total_patients;
            document.getElementById('totalModels').textContent = testData.meta.total_models;
            document.getElementById('totalPrompts').textContent = testData.meta.total_prompts;

            updateDebugStatus();

            // å¡«å……æ‚£è€…é€‰æ‹©å™¨
            const patientSelect = document.getElementById('patientSelect');
            patientSelect.innerHTML = '<option value="">è¯·é€‰æ‹©æ‚£è€…</option>';
            testData.patients.forEach((patient, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${patient.patient_info.name} (${patient.patient_info.gender}, ${patient.patient_info.age})`;
                patientSelect.appendChild(option);
            });

            // å¡«å……æç¤ºè¯é€‰æ‹©å™¨
            const promptSelect = document.getElementById('promptSelect');
            promptSelect.innerHTML = '<option value="">è¯·é€‰æ‹©åˆ†æä»»åŠ¡</option>';
            testData.prompts.forEach((prompt, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `ä»»åŠ¡ ${index + 1}: ${prompt.substring(0, 30)}...`;
                promptSelect.appendChild(option);
            });

            // å¡«å……æ¨¡å‹é€‰æ‹©å™¨
            const modelSelect = document.getElementById('modelSelect');
            modelSelect.innerHTML = '<option value="all">å…¨éƒ¨æ¨¡å‹</option>';
            testData.meta.models.forEach((model, index) => {
                const option = document.createElement('option');
                option.value = model;
                option.textContent = model;
                modelSelect.appendChild(option);
            });

            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            patientSelect.addEventListener('change', function(e) {
                console.log('æ‚£è€…é€‰æ‹©å™¨è¢«ç‚¹å‡»ï¼Œå€¼ä¸º:', e.target.value);
                handlePatientChange(e);
            });
            promptSelect.addEventListener('change', function(e) {
                console.log('åˆ†æä»»åŠ¡é€‰æ‹©å™¨è¢«ç‚¹å‡»ï¼Œå€¼ä¸º:', e.target.value);
                handlePromptChange(e);
            });
            modelSelect.addEventListener('change', function(e) {
                console.log('æ¨¡å‹é€‰æ‹©å™¨è¢«ç‚¹å‡»ï¼Œå€¼ä¸º:', e.target.value);
                handleModelChange(e);
            });

            console.log('âœ… æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨å·²æ·»åŠ ');
        }

        // å¤„ç†æ‚£è€…é€‰æ‹©å˜åŒ–
        function handlePatientChange(e) {
            const patientIndex = e.target.value;
            updateDebugStatus();

            if (!patientIndex) return;

            const patient = testData.patients[patientIndex];
            displayPatientInfo(patient);
            displayConversation(patient);

            // æ›´æ–°æç¤ºè¯é€‰æ‹©å™¨
            const promptSelect = document.getElementById('promptSelect');
            promptSelect.innerHTML = '<option value="">è¯·é€‰æ‹©åˆ†æä»»åŠ¡</option>';
            testData.prompts.forEach((prompt, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `ä»»åŠ¡ ${index + 1}: ${prompt.substring(0, 30)}...`;
                promptSelect.appendChild(option);
            });

            // æ¸…ç©ºä¸»å†…å®¹åŒº
            document.getElementById('mainContent').innerHTML = `
                <div class="loading">
                    <p>è¯·é€‰æ‹©åˆ†æä»»åŠ¡æŸ¥çœ‹æ¨¡å‹å“åº”</p>
                </div>
            `;
        }

        // æ˜¾ç¤ºæ‚£è€…ä¿¡æ¯
        function displayPatientInfo(patient) {
            const infoHTML = `
                <h3>ğŸ‘¤ æ‚£è€…ä¿¡æ¯</h3>
                <div class="info-item">
                    <span class="info-label">å§“å</span>
                    <span class="info-value">${patient.patient_info.name}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">å¹´é¾„</span>
                    <span class="info-value">${patient.patient_info.age}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">æ€§åˆ«</span>
                    <span class="info-value">${patient.patient_info.gender}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">èº«é«˜</span>
                    <span class="info-value">${patient.patient_info.height}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">ä½“é‡</span>
                    <span class="info-value">${patient.patient_info.weight}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">BMI</span>
                    <span class="info-value">${patient.patient_info.bmi}</span>
                </div>
            `;
            document.getElementById('patientInfo').innerHTML = infoHTML;
        }

        // æ˜¾ç¤ºå¯¹è¯è®°å½•
        function displayConversation(patient) {
            const conversation = patient.conversation;
            const lines = conversation.split('\n');

            let messagesHTML = '<h3>ğŸ’¬ å¯¹è¯è®°å½•</h3>';
            let currentMessage = '';
            let currentSpeaker = '';

            for (let line of lines) {
                if (line.match(/^\d+\.\s*(æ‚£è€…|åŒ»åŠ©):/)) {
                    // ä¿å­˜ä¹‹å‰çš„æ¶ˆæ¯
                    if (currentMessage && currentSpeaker) {
                        const messageClass = currentSpeaker === 'æ‚£è€…' ? 'patient' : 'assistant';
                        messagesHTML += `
                            <div class="message ${messageClass}">
                                <div class="message-label">${currentSpeaker}</div>
                                <div>${currentMessage}</div>
                            </div>
                        `;
                    }

                    // è§£ææ–°æ¶ˆæ¯
                    const match = line.match(/^\d+\.\s*(æ‚£è€…|åŒ»åŠ©):\s*(.*)$/);
                    if (match) {
                        currentSpeaker = match[1];
                        currentMessage = match[2];
                    }
                } else if (line.trim() && currentSpeaker) {
                    currentMessage += '\n' + line;
                }
            }

            // æ·»åŠ æœ€åä¸€æ¡æ¶ˆæ¯
            if (currentMessage && currentSpeaker) {
                const messageClass = currentSpeaker === 'æ‚£è€…' ? 'patient' : 'assistant';
                messagesHTML += `
                    <div class="message ${messageClass}">
                        <div class="message-label">${currentSpeaker}</div>
                        <div>${currentMessage}</div>
                    </div>
                `;
            }

            document.getElementById('conversationSection').innerHTML = messagesHTML;
        }

        // å¤„ç†æç¤ºè¯é€‰æ‹©å˜åŒ–
        function handlePromptChange(e) {
            const promptIndex = e.target.value;
            const patientIndex = document.getElementById('patientSelect').value;

            updateDebugStatus();
            console.log('handlePromptChange è¢«è°ƒç”¨äº†ï¼');
            console.log('promptIndex:', promptIndex, 'type:', typeof promptIndex);
            console.log('patientIndex:', patientIndex, 'type:', typeof patientIndex);

            // æ·»åŠ è°ƒè¯•ä¿¡æ¯åˆ°é¡µé¢
            let debugHTML = `
                <div style="padding: 20px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="color: #856404;">ğŸ” è°ƒè¯•ä¿¡æ¯</h3>
                    <p><strong>promptIndex:</strong> "${promptIndex}" (${typeof promptIndex})</p>
                    <p><strong>patientIndex:</strong> "${patientIndex}" (${typeof patientIndex})</p>
            `;

            if (!promptIndex || !patientIndex) {
                debugHTML += `
                    <p style="color: red;"><strong>âŒ æå‰è¿”å›ï¼š</strong> promptIndex æˆ– patientIndex ä¸ºç©º</p>
                    </div>
                `;
                document.getElementById('mainContent').innerHTML = debugHTML + `
                    <div class="loading">
                        <p>è¯·é€‰æ‹©åˆ†æä»»åŠ¡æŸ¥çœ‹æ¨¡å‹å“åº”</p>
                    </div>
                `;
                return;
            }

            const patient = testData.patients[patientIndex];
            const prompt = testData.prompts[promptIndex];

            debugHTML += `
                <p><strong>âœ… æ‚£è€…æ•°æ®:</strong> ${patient ? 'å·²æ‰¾åˆ°' : 'æœªæ‰¾åˆ°'}</p>
                <p><strong>âœ… æç¤ºè¯:</strong> ${prompt ? prompt.substring(0, 50) + '...' : 'æœªæ‰¾åˆ°'}</p>
            `;

            console.log('patient:', patient);
            console.log('patient.prompt_results:', patient.prompt_results);

            // æ‰¾åˆ°å¯¹åº”çš„æ¨¡å‹å“åº”
            const promptData = patient.prompt_results.find(mr => {
                console.log('æ¯”è¾ƒ mr.prompt_index:', mr.prompt_index, 'type:', typeof mr.prompt_index, 'å’Œ promptIndex:', promptIndex);
                return mr.prompt_index == promptIndex;
            });

            console.log('promptData:', promptData);

            debugHTML += `
                <p><strong>prompt_results æ•°é‡:</strong> ${patient.prompt_results.length}</p>
                <p><strong>promptData:</strong> ${promptData ? 'å·²æ‰¾åˆ°' : 'âŒ æœªæ‰¾åˆ°'}</p>
            `;

            if (!promptData) {
                debugHTML += `
                    <p style="color: red;"><strong>âŒ é”™è¯¯ï¼š</strong>åœ¨ prompt_results ä¸­æœªæ‰¾åˆ° prompt_index == ${promptIndex} çš„æ•°æ®</p>
                    <p><strong>å¯ç”¨çš„ prompt_index:</strong> ${patient.prompt_results.map(mr => mr.prompt_index).join(', ')}</p>
                    </div>
                `;
                document.getElementById('mainContent').innerHTML = debugHTML;
                return;
            }

            debugHTML += `<p style="color: green;"><strong>âœ… å‡†å¤‡æ˜¾ç¤ºæ¨¡å‹å“åº”...</strong></p></div>`;

            displayModelResponses(prompt, promptData, debugHTML);
        }

        // å¤„ç†æ¨¡å‹é€‰æ‹©å˜åŒ–
        function handleModelChange(e) {
            updateDebugStatus();

            // é‡æ–°æ˜¾ç¤ºå½“å‰é€‰æ‹©çš„å†…å®¹
            const promptIndex = document.getElementById('promptSelect').value;
            const patientIndex = document.getElementById('patientSelect').value;

            if (!promptIndex || !patientIndex) return;

            const patient = testData.patients[patientIndex];
            const prompt = testData.prompts[promptIndex];
            const promptData = patient.prompt_results.find(mr => mr.prompt_index == promptIndex);

            if (promptData) {
                displayModelResponses(prompt, promptData);
            }
        }

        // æ˜¾ç¤ºæ¨¡å‹å“åº”
        function displayModelResponses(prompt, promptData, debugHTML = '') {
            const selectedModel = document.getElementById('modelSelect').value;

            console.log('displayModelResponses called');
            console.log('selectedModel:', selectedModel);
            console.log('promptData:', promptData);

            let html = debugHTML + `
                <div class="prompt-section">
                    <div class="prompt-title">ğŸ“ åˆ†æä»»åŠ¡</div>
                    <div style="padding: 10px; background: white; border-radius: 8px; line-height: 1.8;">
                        ${prompt}
                    </div>
                </div>
            `;

            // æ ¹æ®é€‰æ‹©çš„æ¨¡å‹è¿‡æ»¤å“åº”
            let responses = promptData.model_responses;
            if (selectedModel !== 'all') {
                responses = responses.filter(r => r.model === selectedModel);
            }

            console.log('filtered responses:', responses);

            if (responses.length === 0) {
                html += `<div class="error">æ²¡æœ‰æ‰¾åˆ°é€‰å®šæ¨¡å‹çš„å“åº”æ•°æ®</div>`;
                document.getElementById('mainContent').innerHTML = html;
                return;
            }

            responses.forEach(response => {
                const timestamp = new Date(response.timestamp).toLocaleString('zh-CN');

                if (response.success) {
                    html += `
                        <div class="model-response">
                            <div class="model-header">
                                <div class="model-name">ğŸ¤– ${response.model}</div>
                                <div>
                                    <span class="success-badge">âœ“ æˆåŠŸ</span>
                                    <span class="timestamp">${timestamp}</span>
                                </div>
                            </div>
                            <div class="response-content">${formatResponse(response.response)}</div>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="model-response">
                            <div class="model-header">
                                <div class="model-name">ğŸ¤– ${response.model}</div>
                                <div class="timestamp">${timestamp}</div>
                            </div>
                            <div class="error">
                                <strong>é”™è¯¯ï¼š</strong>${response.error || 'æœªçŸ¥é”™è¯¯'}
                            </div>
                        </div>
                    `;
                }
            });

            document.getElementById('mainContent').innerHTML = html;
        }

        // æ ¼å¼åŒ–å“åº”æ–‡æœ¬ï¼ˆç®€å•çš„Markdownå¤„ç†ï¼‰
        function formatResponse(text) {
            if (!text) return '';

            // è½¬ä¹‰HTML
            text = text.replace(/&/g, '&amp;')
                      .replace(/</g, '&lt;')
                      .replace(/>/g, '&gt;');

            // å¤„ç†æ ‡é¢˜
            text = text.replace(/^### (.*?)$/gm, '<h3>$1</h3>');
            text = text.replace(/^## (.*?)$/gm, '<h2>$1</h2>');
            text = text.replace(/^# (.*?)$/gm, '<h1>$1</h1>');

            // å¤„ç†ç²—ä½“
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

            // å¤„ç†åˆ—è¡¨
            text = text.replace(/^- (.*?)$/gm, '<li>$1</li>');
            text = text.replace(/(<li>.*?<\/li>\n?)+/g, '<ul>$&</ul>');

            // å¤„ç†å¼•ç”¨
            text = text.replace(/^&gt; (.*?)$/gm, '<blockquote>$1</blockquote>');

            // å¤„ç†æ¢è¡Œ
            text = text.replace(/\n/g, '<br>');

            return text;
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
