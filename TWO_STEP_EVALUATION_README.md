# ä¸¤æ­¥èµ°äº¤å‰è¯„ä¼°æµç¨‹

## ğŸ“‹ è®¾è®¡ç†å¿µ

å°†äº¤å‰è¯„ä¼°åˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹æ­¥éª¤ï¼š

1. **ç¬¬ä¸€æ­¥ï¼šæ”¶é›†åŸå§‹å“åº”** - å¿«é€Ÿè°ƒç”¨APIï¼Œä¿å­˜åŸå§‹å“åº”
2. **ç¬¬äºŒæ­¥ï¼šè§£æè¯„åˆ†æ•°æ®** - æ‰¹é‡è§£æåŸå§‹å“åº”ä¸ºè¯„åˆ†

## âœ… ä¼˜åŠ¿

### 1. æ•°æ®å®‰å…¨
- âœ… åŸå§‹å“åº”æ°¸ä¹…ä¿å­˜ï¼Œä¸æ€•è§£æé”™è¯¯
- âœ… å¯ä»¥åå¤è§£æï¼Œä¸éœ€è¦é‡æ–°è°ƒç”¨API
- âœ… ä¿®æ”¹è§£æé€»è¾‘åå¯ä»¥é‡æ–°è§£ææ‰€æœ‰æ•°æ®

### 2. èŠ‚çœæˆæœ¬
- âœ… APIè°ƒç”¨å’Œè§£æåˆ†ç¦»ï¼Œè§£æé”™è¯¯ä¸ä¼šæŸå¤±APIè´¹ç”¨
- âœ… æ‰¹é‡è§£ææ›´å¿«ï¼Œä¸éœ€è¦ç­‰å¾…API
- âœ… æ–­ç‚¹ç»­ä¼ ï¼Œä¸­æ–­åä»æœªå®Œæˆå¤„ç»§ç»­

### 3. çµæ´»æ€§
- âœ… å¯ä»¥å…ˆå¿«é€Ÿæ”¶é›†æ‰€æœ‰æ•°æ®ï¼Œå†æ…¢æ…¢è§£æ
- âœ… å¯ä»¥åªè§£æéƒ¨åˆ†æ•°æ®è¿›è¡Œæµ‹è¯•
- âœ… å¯ä»¥ç”¨ä¸åŒçš„è§£æç­–ç•¥å¯¹æ¯”ç»“æœ

---

## ğŸš€ ä½¿ç”¨æµç¨‹

### æ­¥éª¤1ï¼šæ”¶é›†åŸå§‹å“åº”

```bash
# æµ‹è¯•æ¨¡å¼ï¼ˆæ¨èé¦–æ¬¡ä½¿ç”¨ï¼‰
python run_cross_evaluation.py --test-mode

# è¯„ä¼°æŒ‡å®šæ‚£è€…
python run_cross_evaluation.py --patients æ‚£è€…1 æ‚£è€…2

# è¯„ä¼°æ‰€æœ‰æ•°æ®ï¼ˆæ…ç”¨ï¼Œä¼šäº§ç”Ÿå¤§é‡APIè°ƒç”¨ï¼‰
python run_cross_evaluation.py
```

**è¾“å‡º**ï¼šåŸå§‹å“åº”ä¿å­˜åœ¨ `output/cross_evaluation_results/{æ‚£è€…}/conv_{å¯¹è¯ID}/raw/`

```
output/cross_evaluation_results/
â””â”€â”€ æ‚£è€…1/
    â””â”€â”€ conv_1_ä¸»è¯‰/
        â””â”€â”€ raw/                                    â¬…ï¸ åŸå§‹å“åº”ç›®å½•
            â”œâ”€â”€ gpt-5.1_by_deepseek.json           # åŒ…å«raw_responseå­—æ®µ
            â”œâ”€â”€ gpt-5.1_by_gemini.json
            â”œâ”€â”€ deepseek_by_gpt-5.1.json
            â””â”€â”€ ...
```

**æ–‡ä»¶æ ¼å¼**ï¼š
```json
{
  "patient": "æ‚£è€…1",
  "conversation_id": "1",
  "conversation_title": "ä¸»è¯‰",
  "generated_by": "gpt-5.1",
  "evaluated_by": "deepseek/deepseek-v3.1",
  "original_output": "...",
  "raw_response": "è¿™é‡Œæ˜¯APIè¿”å›çš„åŸå§‹æ–‡æœ¬å“åº”",  â¬…ï¸ å…³é”®ï¼šåŸå§‹å“åº”
  "metadata": {
    "timestamp": "2025-11-18T21:00:00",
    "evaluator_model": "deepseek/deepseek-v3.1",
    "included_context": true,
    "prompt_length": 5234
  }
}
```

---

### æ­¥éª¤2ï¼šè§£æåŸå§‹å“åº”

```bash
# è§£ææ‰€æœ‰åŸå§‹å“åº”
python parse_raw_responses.py

# è§£ææŒ‡å®šæ‚£è€…
python parse_raw_responses.py --patients æ‚£è€…1

# è§£ææŒ‡å®šå¯¹è¯
python parse_raw_responses.py --conversations 1 2
```

**è¾“å‡º**ï¼šè§£æåçš„è¯„åˆ†æ•°æ®ä¿å­˜åœ¨ `output/cross_evaluation_results/{æ‚£è€…}/conv_{å¯¹è¯ID}/evaluations/`

```
output/cross_evaluation_results/
â””â”€â”€ æ‚£è€…1/
    â””â”€â”€ conv_1_ä¸»è¯‰/
        â”œâ”€â”€ raw/                                    # åŸå§‹å“åº”ï¼ˆç¬¬ä¸€æ­¥ï¼‰
        â”‚   â””â”€â”€ gpt-5.1_by_deepseek.json
        â””â”€â”€ evaluations/                            # è§£æç»“æœï¼ˆç¬¬äºŒæ­¥ï¼‰â¬…ï¸
            â””â”€â”€ gpt-5.1_by_deepseek.json            # åŒ…å«è¯„åˆ†æ•°æ®
```

**è§£æåæ–‡ä»¶æ ¼å¼**ï¼š
```json
{
  "patient": "æ‚£è€…1",
  "conversation_id": "1",
  "generated_by": "gpt-5.1",
  "evaluated_by": "deepseek/deepseek-v3.1",
  "original_output": "...",
  "evaluation": {                                    â¬…ï¸ è§£æåçš„è¯„åˆ†
    "dimensions": {
      "accuracy": {"score": 4, "reasoning": "..."},
      "completeness": {"score": 5, "reasoning": "..."},
      "format": {"score": 4, "reasoning": "..."},
      "language": {"score": 5, "reasoning": "..."},
      "logic": {"score": 4, "reasoning": "..."}
    },
    "overall_comment": "..."
  },
  "average_score": 4.4,                             â¬…ï¸ å¹³å‡åˆ†
  "metadata": {...}
}
```

---

### æ­¥éª¤3ï¼šç”Ÿæˆè¯„åˆ†çŸ©é˜µ

```bash
# ä½¿ç”¨å·²è§£æçš„æ•°æ®ç”ŸæˆçŸ©é˜µï¼ˆè·³è¿‡è¯„ä¼°æ­¥éª¤ï¼‰
python run_cross_evaluation.py --skip-evaluation
```

**è¾“å‡º**ï¼šè¯„åˆ†çŸ©é˜µå’Œç»Ÿè®¡æŠ¥å‘Š

---

## ğŸ“Š å®Œæ•´ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæµ‹è¯•æ¨¡å¼

```bash
# 1. æ”¶é›†åŸå§‹å“åº”ï¼ˆ1ä¸ªæ‚£è€…ï¼Œ1ä¸ªå¯¹è¯ï¼Œ8Ã—8=64æ¬¡APIè°ƒç”¨ï¼‰
python run_cross_evaluation.py --test-mode

# è¾“å‡ºç¤ºä¾‹ï¼š
# å¤„ç†æ‚£è€…: æ‚£è€…1
#   å¯¹è¯ç±»å‹: ä¸»è¯‰ (ID: 1)
#     è¯„ä¼° gpt-5.1 çš„è¾“å‡º...
#       âœ“ å®Œæˆ: deepseek/deepseek-v3.1 (åŸå§‹å“åº”å·²ä¿å­˜)
#       âœ“ å®Œæˆ: gemini-2.5-pro (åŸå§‹å“åº”å·²ä¿å­˜)
#       ...
# æˆåŠŸ: 64/64

# 2. è§£æåŸå§‹å“åº”
python parse_raw_responses.py --patients æ‚£è€…1 --conversations 1

# è¾“å‡ºç¤ºä¾‹ï¼š
# å¤„ç†æ‚£è€…: æ‚£è€…1
#   å¯¹è¯ 1:
#     âœ“ è§£æ: gpt-5.1_by_deepseek (å¹³å‡åˆ†: 4.2)
#     âœ“ è§£æ: gpt-5.1_by_gemini (å¹³å‡åˆ†: 4.5)
#     ...
# æˆåŠŸ: 64/64

# 3. ç”ŸæˆçŸ©é˜µ
python run_cross_evaluation.py --skip-evaluation --test-mode

# è¾“å‡ºï¼šè¯„åˆ†çŸ©é˜µå’Œæ’å
```

---

### ç¤ºä¾‹2ï¼šå¤§è§„æ¨¡è¯„ä¼°

```bash
# 1. å…ˆè¯„ä¼°å‡ ä¸ªæ‚£è€…æµ‹è¯•ï¼ˆæ¯”å¦‚æ‚£è€…1å’Œæ‚£è€…2ï¼‰
python run_cross_evaluation.py --patients æ‚£è€…1 æ‚£è€…2 --conversations 1

# 2. æŸ¥çœ‹åŸå§‹å“åº”ï¼Œç¡®è®¤æ²¡é—®é¢˜
ls output/cross_evaluation_results/æ‚£è€…1/conv_1_ä¸»è¯‰/raw/

# 3. è§£æè¿™å‡ ä¸ªæ‚£è€…
python parse_raw_responses.py --patients æ‚£è€…1 æ‚£è€…2

# 4. ç¡®è®¤è§£ææ­£ç¡®åï¼Œç»§ç»­è¯„ä¼°å…¶ä»–æ‚£è€…
python run_cross_evaluation.py --patients æ‚£è€…3 æ‚£è€…4 æ‚£è€…5

# 5. æ‰¹é‡è§£ææ‰€æœ‰
python parse_raw_responses.py

# 6. ç”Ÿæˆæœ€ç»ˆçŸ©é˜µ
python run_cross_evaluation.py --skip-evaluation
```

---

### ç¤ºä¾‹3ï¼šè§£æå¤±è´¥åé‡æ–°è§£æ

```bash
# å‡è®¾ç¬¬ä¸€æ¬¡è§£ææœ‰é—®é¢˜
python parse_raw_responses.py
# æˆåŠŸ: 50/64, å¤±è´¥: 14/64

# ä¿®æ”¹è§£æé€»è¾‘åï¼Œé‡æ–°è§£æï¼ˆä¸éœ€è¦é‡æ–°è°ƒç”¨APIï¼ï¼‰
python parse_raw_responses.py
# æˆåŠŸ: 64/64
```

---

## ğŸ”„ æ–­ç‚¹ç»­ä¼ 

ä¸¤æ­¥èµ°æµç¨‹å®Œç¾æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼š

```bash
# å¼€å§‹è¯„ä¼°
python run_cross_evaluation.py

# å®Œæˆ100ä¸ªè¯„ä¼°åæ„å¤–ä¸­æ–­...

# é‡æ–°è¿è¡Œï¼Œè‡ªåŠ¨è·³è¿‡å·²å®Œæˆçš„
python run_cross_evaluation.py
# è¾“å‡º: âœ“ å·²ç¼“å­˜: xxx (è·³è¿‡å·²æœ‰çš„100ä¸ª)
# ä»ç¬¬101ä¸ªç»§ç»­
```

---

## ğŸ“ ç›®å½•ç»“æ„

```
output/cross_evaluation_results/
â”œâ”€â”€ æ‚£è€…1/
â”‚   â”œâ”€â”€ conv_1_ä¸»è¯‰/
â”‚   â”‚   â”œâ”€â”€ raw/                       # ç¬¬ä¸€æ­¥ï¼šåŸå§‹å“åº”
â”‚   â”‚   â”‚   â”œâ”€â”€ gpt-5.1_by_deepseek.json
â”‚   â”‚   â”‚   â”œâ”€â”€ gpt-5.1_by_gemini.json
â”‚   â”‚   â”‚   â””â”€â”€ ...ï¼ˆ64ä¸ªæ–‡ä»¶ï¼‰
â”‚   â”‚   â”œâ”€â”€ evaluations/               # ç¬¬äºŒæ­¥ï¼šè§£æç»“æœ
â”‚   â”‚   â”‚   â”œâ”€â”€ gpt-5.1_by_deepseek.json
â”‚   â”‚   â”‚   â”œâ”€â”€ gpt-5.1_by_gemini.json
â”‚   â”‚   â”‚   â””â”€â”€ ...ï¼ˆ64ä¸ªæ–‡ä»¶ï¼‰
â”‚   â”‚   â””â”€â”€ matrix.json                # ç¬¬ä¸‰æ­¥ï¼šè¯„åˆ†çŸ©é˜µ
â”‚   â”œâ”€â”€ conv_2_ç°ç—…å²/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ æ‚£è€…2/
â””â”€â”€ summary/
    â””â”€â”€ statistics.json                 # æ€»ä½“ç»Ÿè®¡
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### ç¼“å­˜æœºåˆ¶

`cross_evaluation/config.py`:

```python
EVALUATION_CONFIG = {
    "enable_caching": True    # å¯ç”¨ç¼“å­˜ï¼Œæ£€æŸ¥rawæ–‡ä»¶é¿å…é‡å¤
}
```

- âœ… å·²å¯ç”¨ï¼šç¬¬ä¸€æ­¥ä¼šè·³è¿‡å·²æœ‰çš„rawæ–‡ä»¶
- âœ… æ–­ç‚¹ç»­ä¼ ï¼šä¸­æ–­åé‡æ–°è¿è¡Œè‡ªåŠ¨ç»§ç»­

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å…ˆå°è§„æ¨¡æµ‹è¯•
```bash
# å…ˆæµ‹è¯•1ä¸ªæ‚£è€…
python run_cross_evaluation.py --test-mode
python parse_raw_responses.py --patients æ‚£è€…1
```

### 2. åˆ†æ‰¹å¤„ç†
```bash
# æŒ‰æ‚£è€…åˆ†æ‰¹
for patient in æ‚£è€…1 æ‚£è€…2 æ‚£è€…3; do
    python run_cross_evaluation.py --patients $patient
    python parse_raw_responses.py --patients $patient
done
```

### 3. ç›‘æ§è¿›åº¦
```bash
# æŸ¥çœ‹å·²å®Œæˆçš„åŸå§‹å“åº”
find output/cross_evaluation_results -name "*.json" -path "*/raw/*" | wc -l

# æŸ¥çœ‹å·²è§£æçš„
find output/cross_evaluation_results -name "*.json" -path "*/evaluations/*" | wc -l
```

### 4. æ•°æ®å¤‡ä»½
```bash
# å¤‡ä»½åŸå§‹å“åº”ï¼ˆéå¸¸é‡è¦ï¼ï¼‰
tar -czf raw_responses_backup_$(date +%Y%m%d).tar.gz \
    output/cross_evaluation_results/*/*/raw/
```

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šè§£æå¤±è´¥

**ç°è±¡**ï¼š`python parse_raw_responses.py` æŠ¥é”™

**è§£å†³**ï¼š
1. æŸ¥çœ‹å¤±è´¥çš„åŸå§‹å“åº”æ–‡ä»¶
2. æ£€æŸ¥raw_responseå­—æ®µæ˜¯å¦æ˜¯æœ‰æ•ˆJSON
3. ä¿®æ”¹è§£æé€»è¾‘åé‡æ–°è¿è¡Œï¼ˆä¸éœ€è¦é‡æ–°è°ƒç”¨APIï¼‰

### é—®é¢˜2ï¼šåŸå§‹å“åº”æ–‡ä»¶æŸå

**ç°è±¡**ï¼šJSONæ–‡ä»¶æ— æ³•è¯»å–

**è§£å†³**ï¼š
1. åˆ é™¤æŸåçš„æ–‡ä»¶
2. é‡æ–°è¿è¡Œç¬¬ä¸€æ­¥ï¼ˆåªä¼šé‡æ–°è¯„ä¼°è¿™ä¸€ä¸ªï¼‰

### é—®é¢˜3ï¼šæ‰¾ä¸åˆ°åŸå§‹å“åº”

**ç°è±¡**ï¼š`parse_raw_responses.py` æ‰¾ä¸åˆ°æ–‡ä»¶

**è§£å†³**ï¼š
1. ç¡®è®¤ç¬¬ä¸€æ­¥å·²è¿è¡Œï¼š`ls output/cross_evaluation_results/æ‚£è€…1/conv_1/raw/`
2. æ£€æŸ¥ç›®å½•è·¯å¾„æ˜¯å¦æ­£ç¡®

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| æ¨¡å¼ | APIè°ƒç”¨ | æ€»æ—¶é—´ | æ•°æ®å®‰å…¨ | çµæ´»æ€§ |
|------|---------|--------|----------|--------|
| **æ—§æ¨¡å¼ï¼ˆä¸€æ­¥ï¼‰** | è°ƒç”¨+è§£æåŒæ­¥ | 4å°æ—¶ | âš ï¸ ä¸­ç­‰ | âŒ ä½ |
| **æ–°æ¨¡å¼ï¼ˆä¸¤æ­¥ï¼‰** | è°ƒç”¨â†’ä¿å­˜â†’è§£æ | æ”¶é›†4å°æ—¶<br>è§£æ5åˆ†é’Ÿ | âœ… é«˜ | âœ… é«˜ |

**ä¸¤æ­¥èµ°æ¨¡å¼ä¼˜åŠ¿**ï¼š
- âœ… è§£æå¤±è´¥ä¸å½±å“åŸå§‹æ•°æ®
- âœ… å¯ä»¥åå¤ä¿®æ”¹è§£æé€»è¾‘é‡æ–°è§£æ
- âœ… æ•°æ®æ°¸ä¹…ä¿å­˜ï¼Œéšæ—¶å¯ç”¨

---

## ğŸ¯ æ€»ç»“

ä¸¤æ­¥èµ°æµç¨‹çš„æ ¸å¿ƒæ€æƒ³ï¼š
1. **ç¬¬ä¸€æ­¥ä¼˜å…ˆçº§**ï¼šå¿«é€Ÿã€å¯é åœ°æ”¶é›†æ‰€æœ‰åŸå§‹APIå“åº”
2. **ç¬¬äºŒæ­¥ç‹¬ç«‹æ€§**ï¼šè§£æä¸æ”¶é›†å®Œå…¨åˆ†ç¦»ï¼Œå¤±è´¥å¯é‡è¯•
3. **æ•°æ®ä¼˜å…ˆ**ï¼šåŸå§‹æ•°æ®æ˜¯æœ€å®è´µçš„ï¼Œå¿…é¡»å®‰å…¨ä¿å­˜

**ä½¿ç”¨å»ºè®®**ï¼š
- âœ… æ€»æ˜¯ä½¿ç”¨ä¸¤æ­¥èµ°æµç¨‹
- âœ… å®šæœŸå¤‡ä»½rawç›®å½•
- âœ… è§£æå‰å…ˆæµ‹è¯•å°æ ·æœ¬
- âœ… ä¿®æ”¹è§£æé€»è¾‘åé‡æ–°è§£æ

---

**ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¥æœŸ**: 2025-11-18
**é€‚ç”¨èŒƒå›´**: æ‰€æœ‰äº¤å‰è¯„ä¼°ä»»åŠ¡
